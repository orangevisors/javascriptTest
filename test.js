"use strict";var e=require("ava");function t(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}require("@k2oss/k2-broker-core/test-framework"),require("./index");var s=t(e);function a(e,t){global[e]=t}s.default("describe returns the hardcoded instance",async e=>{let t=null;a("postSchema",(function(e){t=e})),await Promise.resolve(ondescribe({configuration:{}})),e.deepEqual(t,{objects:{todo:{displayName:"TODO",description:"Manages a TODO list",properties:{id:{displayName:"ID",type:"number"},userId:{displayName:"User ID",type:"number"},title:{displayName:"Title",type:"string"},completed:{displayName:"Completed",type:"boolean"}},methods:{get:{displayName:"Get TODO",type:"read",inputs:["id"],outputs:["id","userId","title","completed"]},getParams:{displayName:"Get TODO",type:"read",parameters:{pid:{displayName:"param1",description:"Description Of Param 1",type:"number"}},requiredParameters:["pid"],outputs:["id"]}}}}}),e.pass()}),s.default("execute fails with the wrong parameters",async e=>{let t=await e.throwsAsync(Promise.resolve(onexecute({objectName:"test1",methodName:"unused",parameters:{},properties:{},configuration:{},schema:{}})));e.deepEqual(t.message,"The object test1 is not supported."),t=await e.throwsAsync(Promise.resolve(onexecute({objectName:"todo",methodName:"test2",parameters:{},properties:{},configuration:{},schema:{}}))),e.deepEqual(t.message,"The method test2 is not supported."),e.pass()}),s.default("execute passes with method params",async e=>{let t=null;a("postResult",(function(e){t=e})),await Promise.resolve(onexecute({objectName:"todo",methodName:"getParams",parameters:{pid:456},properties:{},configuration:{},schema:{}})),e.deepEqual(t,{id:456}),e.pass()}),s.default("execute passes",async e=>{let t=null;a("XMLHttpRequest",class{constructor(){t=this.recorder={},this.recorder.headers={}}open(e,t){this.recorder.opened={method:e,url:t}}setRequestHeader(e,t){this.recorder.headers[e]=t}send(){queueMicrotask(()=>{this.readyState=4,this.status=200,this.responseText=JSON.stringify({id:123,userId:51,title:"Groceries",completed:!1}),this.onreadystatechange(),delete this.responseText})}});let s=null;a("postResult",(function(e){s=e})),await Promise.resolve(onexecute({objectName:"todo",methodName:"get",parameters:{},properties:{id:123},configuration:{},schema:{}})),e.deepEqual(t,{opened:{method:"GET",url:"https://jsonplaceholder.typicode.com/todos/123"},headers:{test:"test value"}}),e.deepEqual(s,{id:123,userId:51,title:"Groceries",completed:!1}),e.pass()});
//# sourceMappingURL=test.js.map
